<html>
<head>
   <script src="../../Grid/GridE.js"> </script>
</head>
<body>
   <script>

// -----------------------------------------------------------------------------------------------------------

Grids.OnContextMenu = function(G,row,col,result){
if(row.id==1 && col=="MENU"){
   if(result=="Clear") G.SetValue(row,col,"",1);
   if(result=="Edit") G.Prompt("Enter new value",G.GetString(row,col),function (val){ if(val!=null) G.SetString(row,col,val,1); } );
   if(result=="Auto") G.SetValue(row,col,"API OnContextMenu",1); 
   }
}

// -----------------------------------------------------------------------------------------------------------

Grids.OnRightClick = function(G,row,col,x,y,event){
G.CloseDialog(); // Closes previous dialog in grid if any
if(row.id==4 && col=="MENU"){
   G.Dialog = ShowMenu({ Items:[
         { Name:"Clear", Text:"Clear value", OnClick:function(){ G.SetValue(row,col,"",1); } },
         { Name:"Edit", Text:"Edit value", OnClick:function(){ G.Prompt("Enter new value",G.GetString(row,col),function (val){ if(val!=null) G.SetString(row,col,val,1); } ); } },
         { Name:"Auto", Text:"Set original value", OnClick:function(){ G.SetValue(row,col,"Custom OnRightClick",1); } }
      ]},{
         Tag:G.GetCell(row,col),Align:"above right",Y:-10
         });
   return true;
   }
}

// -----------------------------------------------------------------------------------------------------------

Grids.OnTip = function(G,row,col,tip,cx,cy,x,y){
if(row.id==4 && col=="TIP"){
   return "This is tip generated by OnTip event handler for cell ["+row.id+","+col+"]";
   }
return tip;   
}

// -----------------------------------------------------------------------------------------------------------

Grids.OnHint = function(G,row,col,hint){
if(row.id==4 && col=="HINT"){
   return "This is hint generated by OnHint<br> event handler for cell ["+row.id+","+col+"]:<br><div style='color:red;'>"+hint+"</div>";
   }
return hint;   
}

// -----------------------------------------------------------------------------------------------------------

function ShowCustomCalendar(G,row,col,x,y){
G.CloseDialog(); // Closes any previous dialog
G.EndEdit(1);    // Finishes editing if any

// --- Creates the custom calendar, here just simple input ---
var d = document.createElement("div"), s = d.style;
s.position = "absolute";
s.left = x+"px";
s.top = y+"px";
s.background = "silver";
s.border = "1px solid black";
s.zIndex = "300";
d.innerHTML = "<div>Custom calendar dialog example</div><input style='width:200px' value='"+G.GetString(row,col)+"'>";
d.onclick = CancelEvent; // suppresses grid OnClick handler
document.body.appendChild(d);
d.lastChild.focus();
d.lastChild.select();
d.lastChild.onkeydown = function(ev){
   if(!ev) ev = event;
   var key = ev.keyCode ? ev.keyCode : ev.charCode;
   if(key==13) { // Enter - save 
      G.SetString(row,col,this.value,1);
      G.CloseDialog();
      }
   if(key==27){ // Esc - cancel
      G.CloseDialog();
      }      
   }

// --- Sets the custom calendar as grid dialog with Close method called to close the calendar on demand ---
G.Dialog = { Close: function(){ document.body.removeChild(d); } } 

return true;
}
// -----------------------------------------------------------------------------------------------------------
function ShowCustomMenu(G,row,col,x,y){
G.CloseDialog(); // Closes any previous dialog
G.EndEdit(1);    // Finishes editing if any
var M = {Default:{Bool:1},Items:"|A|B|C|D",Buttons:["Ok"]};
M.OnSave = function(){
   var s = "";
   for(var i=0;i<M.Items.length;i++){
      if(M.Items[i].Value) s += (s?"+":"") + M.Items[i].Name;
      }
   G.SetString(row,col,s,1);
   }
M = ShowMenu(M,{X:x,Y:y});

G.Dialog = M; // TreeGrid Menu defines the Close method

return true;
}
// -----------------------------------------------------------------------------------------------------------
function ShowCustomDialog(G,row,col,x,y){
G.CloseDialog(); // Closes any previous dialog
G.EndEdit(1);    // Finishes editing if any
var M = {Body:"<div style='background:yellow'><div>Custom edit dialog example</div><input style='width:200px' value='"+G.GetString(row,col)+"'></div>"};
M = ShowDialog(M,{X:x,Y:y});
var I = M.Tag.getElementsByTagName("input")[0];
I.onkeydown = function(ev){
   if(!ev) ev = event;
   var key = ev.keyCode ? ev.keyCode : ev.charCode;
   if(key==13) { // Enter - save 
      G.SetString(row,col,this.value,1);
      G.CloseDialog();
      }
   if(key==27){ // Esc - cancel
      G.CloseDialog();
      }  
   }
I.focus();
I.select();

G.Dialog = M; // TreeGrid Menu defines the Close method

return true;
}

// -----------------------------------------------------------------------------------------------------------
   </script>
   <!-- Styles specific for the example -->
   <style>
      .Red { background:#FAA; }
   </style>
      
   <style>
      b { color:Red; }
      li { padding-bottom:8px; }
      ul { margin-left:20px; margin-top:6px; margin-bottom:0px; font: 13px Arial; }
      h2 { display:inline; font:bold 20px Arial; padding-left:6px; padding-right:6px; background:#FAA; color:black; margin:0px; font-style:normal; }
      h3 { display:inline; font:bold 15px Arial; padding-left:6px; padding-right:6px; background:yellow; color:black; margin:0px; font-style:normal;  }
      h4 { display:inline; font:bold 15px Arial; padding-left:6px; padding-right:6px; background:#FAA; color:black; margin:0px; font-style:normal;  }
   </style>
   <center style='font:bold 20px Arial;color:Blue;'>TreeGrid <b>Cells</b> Tutorial</center>
   <center style='font:bold 30px Arial'>9. Cell Events, Menu, Tip, Hint and Custom dialogs</center>
   <center style='font:bold italic;'>Cell API and XML events, popup Menu, tooltip, Hint and showing custom dialogs by API</center>
   <br />
   <div style='margin-bottom:6px;'><a href='09 - Cell events.xml'>09 - <h2>Cell events</h2>.xml</a></div>
   <div style='width:350px; height:250px;'>
      <bdo Debug='check' Data_Url='09 - Cell events.xml'></bdo>
   </div>
   
   <ul>
      <li>
         <h3>Menu</h3> attribute defines popup menu shown on right click to the cell or row.<br />
         The menu can be defined as first character separated array or by complete TreeGrid JSON menu definition.<br />
         The selected item can be got in API event <b>OnContextMenu</b> or in the JSON menu events <b>OnSave</b> or <b>OnClick</b>.<br />
         The popup menu can be also shown by custom way by method API <b>ShowPopup</b> or <b>ShowMenu</b> in any event handler like <b>OnRightClick</b>.<br />
      </li>
      <li>
         <h3>Tip</h3> attribute defines tooltip for the cell, or for cell part like side button or panel icon.<br />
         There can be also defined more tooltips for particular cell value (e.g. for button on/off).<br />
         The tip content supports any HTML code including images or more lines.<br />
         Is possible also predefine tooltip position where it will be shown by <b>TipPosition</b> attribute.<br />
         When the Tip attribute is 1, it shows actual cell value as tooltip.<br />
         The tooltip content can be also created dynamically in API event <b>OnTip</b>.
      </li>
      <li><h4>Hint</h4> is feature that shows the whole content of overflowed cell as popup directly above the cell.<br />
      It is turn on by default for all cell types except Radio, Gantt, Chart, Abs and Icon and can be also disabled by <b>ShowHint</b>='0'.<br />
      The text shown can be dynamically changed or created by API event <b>OnHint</b>.
      </li>
      <li><h4>Custom dialog</h4> like calendar can be defined in this way:
         <ul>
         <li>
            Define the XML event (in cell or column) for click to the button, for calendar it is <b>OnClickSideDate</b>, for defaults <b>OnClickSideDefaults</b> and for custom Button/Icon <b>OnClickSideButton</b> or <b>OnClickSideIcon</b>.<br />
            This event has four parameters: Grid, Row, Col, Event, the event contains also the position of mouse click.
         </li>
         <li>
            In this event handler show the custom dialog on given position, for the cell or on mouse click position.
         </li>
         <li>
            Close any previous dialog in grid by <b>Grid.CloseDialog()</b>;
         </li>
         <li>
            Optionally finish editing by <b>Grid.EndEdit(1)</b>; or cancel editing by Grid.EndEdit(0);
         </li>
         <li>
            The created dialog object (or any other custom object) assign to <b>Grid.Dialog</b> property. <br />
            This object should define its <b>Close</b> method that is called by grid when the dialog should be closed on demand (for example if a user clicks to another cell).<br />
            For example: Grid.Dialog = { Close:function(){ CloseMyDialog(); } }
         </li>
         </ul>
      </li>
   </ul>
</body>
</html>